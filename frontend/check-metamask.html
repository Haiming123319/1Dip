<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaMask 检查助手</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f7fa;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin: 16px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .step {
            display: flex;
            align-items: flex-start;
            margin: 16px 0;
            padding: 16px;
            border-radius: 8px;
            background: #f8f9ff;
            border-left: 4px solid #4f46e5;
        }
        .step-number {
            background: #4f46e5;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 16px;
            flex-shrink: 0;
        }
        .big-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin: 16px 0;
        }
        .big-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .status {
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
            font-weight: 500;
        }
        .status.checking { background: #e0f2fe; color: #0277bd; }
        .status.success { background: #e8f5e8; color: #2e7d32; }
        .status.error { background: #ffebee; color: #d32f2f; }
        .status.warning { background: #fff3e0; color: #f57c00; }
        .download-link {
            display: inline-block;
            background: #f39c12;
            color: white;
            padding: 12px 24px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            margin: 8px 0;
        }
        .metamask-icon {
            font-size: 48px;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1 style="text-align: center; color: #333;">🦊 MetaMask 检查助手</h1>
        <div class="metamask-icon">🦊</div>
        <p style="text-align: center; color: #666;">让我们检查你的MetaMask钱包状态</p>
    </div>

    <div class="card">
        <h2>📋 检查清单</h2>
        
        <div class="step">
            <div class="step-number">1</div>
            <div>
                <strong>查看浏览器扩展栏</strong><br>
                在浏览器右上角（地址栏旁边）查看是否有 🦊 狐狸图标<br>
                <small style="color: #666;">如果没有看到，可能需要点击拼图图标（扩展管理）找找</small>
            </div>
        </div>

        <div class="step">
            <div class="step-number">2</div>
            <div>
                <strong>检查扩展是否启用</strong><br>
                如果看到狐狸图标但是灰色的，说明扩展被禁用了<br>
                <small style="color: #666;">点击图标或者右键选择"启用"</small>
            </div>
        </div>

        <div class="step">
            <div class="step-number">3</div>
            <div>
                <strong>自动检测</strong><br>
                点击下面的按钮让程序自动检测MetaMask状态
            </div>
        </div>
    </div>

    <div class="card">
        <button class="big-button" id="checkBtn">🔍 开始检测 MetaMask</button>
        <div id="result"></div>
    </div>

    <div class="card" id="installGuide" style="display: none;">
        <h2>📥 安装 MetaMask</h2>
        <p>如果你还没有安装MetaMask，请按照以下步骤：</p>
        
        <div class="step">
            <div class="step-number">1</div>
            <div>
                <strong>下载 MetaMask</strong><br>
                <a href="https://metamask.io/download/" target="_blank" class="download-link">
                    前往官网下载 MetaMask
                </a><br>
                <small style="color: #666;">支持 Chrome、Firefox、Edge、Safari 等浏览器</small>
            </div>
        </div>

        <div class="step">
            <div class="step-number">2</div>
            <div>
                <strong>安装扩展</strong><br>
                点击"添加到浏览器"按钮，然后点击"添加扩展"
            </div>
        </div>

        <div class="step">
            <div class="step-number">3</div>
            <div>
                <strong>设置钱包</strong><br>
                安装后会自动打开设置页面，选择"创建新钱包"或"导入现有钱包"
            </div>
        </div>

        <div class="step">
            <div class="step-number">4</div>
            <div>
                <strong>刷新页面</strong><br>
                安装完成后，刷新本页面重新检测
            </div>
        </div>
    </div>

    <script>
        document.getElementById('checkBtn').addEventListener('click', function() {
            const resultDiv = document.getElementById('result');
            const installGuide = document.getElementById('installGuide');
            
            resultDiv.innerHTML = '<div class="status checking">🔍 正在检测 MetaMask...</div>';
            
            // 等待一下让用户看到检测过程
            setTimeout(() => {
                checkMetaMask();
            }, 1000);
            
            function checkMetaMask() {
                let html = '';
                
                // 检查 window 对象
                html += '<div class="status checking">🔍 检查浏览器环境...</div>';
                
                if (typeof window === 'undefined') {
                    html += '<div class="status error">❌ 浏览器环境异常</div>';
                    resultDiv.innerHTML = html;
                    return;
                }
                
                html += '<div class="status success">✅ 浏览器环境正常</div>';
                
                // 检查 ethereum 对象
                html += '<div class="status checking">🔍 检查 window.ethereum...</div>';
                
                setTimeout(() => {
                    if (typeof window.ethereum === 'undefined') {
                        html += '<div class="status error">❌ 未检测到 window.ethereum</div>';
                        html += '<div class="status warning">⚠️ 这通常意味着：<br>1. MetaMask 未安装<br>2. MetaMask 被禁用<br>3. 使用了不支持的浏览器</div>';
                        resultDiv.innerHTML = html;
                        installGuide.style.display = 'block';
                        return;
                    }
                    
                    html += '<div class="status success">✅ 检测到 window.ethereum</div>';
                    
                    // 检查是否是 MetaMask
                    if (window.ethereum.isMetaMask) {
                        html += '<div class="status success">✅ 确认是 MetaMask 钱包</div>';
                    } else {
                        html += '<div class="status warning">⚠️ 检测到其他钱包，可能不是 MetaMask</div>';
                    }
                    
                    // 尝试获取账户
                    html += '<div class="status checking">🔍 检查钱包连接状态...</div>';
                    
                    setTimeout(async () => {
                        try {
                            const accounts = await window.ethereum.request({ 
                                method: 'eth_accounts' 
                            });
                            
                            if (accounts.length > 0) {
                                html += `<div class="status success">✅ 已连接账户: ${accounts[0]}</div>`;
                            } else {
                                html += '<div class="status warning">⚠️ 未连接任何账户（这是正常的）</div>';
                            }
                            
                            // 检查网络
                            try {
                                const chainId = await window.ethereum.request({ 
                                    method: 'eth_chainId' 
                                });
                                const networks = {
                                    '0x1': 'Ethereum 主网',
                                    '0x5': 'Goerli 测试网',
                                    '0xaa36a7': 'Sepolia 测试网',
                                    '0x89': 'Polygon 主网'
                                };
                                const networkName = networks[chainId] || `未知网络 (${chainId})`;
                                html += `<div class="status success">✅ 当前网络: ${networkName}</div>`;
                            } catch (error) {
                                html += `<div class="status warning">⚠️ 无法获取网络信息: ${error.message}</div>`;
                            }
                            
                            html += '<div class="status success">🎉 MetaMask 工作正常！你可以回到主应用尝试连接了</div>';
                            html += '<div style="text-align: center; margin: 20px 0;"><a href="index.html" style="background: #4f46e5; color: white; padding: 12px 24px; border-radius: 6px; text-decoration: none; font-weight: bold;">返回主应用</a></div>';
                            
                        } catch (error) {
                            html += `<div class="status error">❌ 钱包通信失败: ${error.message}</div>`;
                        }
                        
                        resultDiv.innerHTML = html;
                    }, 1000);
                }, 1000);
            }
        });
    </script>
</body>
</html> 